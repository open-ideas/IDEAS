group: deprecated-2017Q2

language: python
python:
  - "2.7"

cache: pip

notifications:
  email: false

git:
  depth: 10

services:
  - docker

#  - TEST_ARG="make test-documentation test-experiment-setup test-autogenerated-files"
env:
  - TEST_ARG="make test-dymola    PACKAGE=IDEAS.Fluid.{Actuators,BaseClasses,Chillers,Delays,Examples,FixedResistances}"
  - TEST_ARG="make test-dymola    PACKAGE=IDEAS.Fluid.{HeatExchangers,HeatPumps,Interfaces,MassExchangers,MixingVolumes,Movers,Sensors,Sources,Storage}"
  - TEST_ARG="make test-dymola    PACKAGE=IDEAS.ThermalZones"
  - TEST_ARG="make test-dymola    PACKAGE=IDEAS.{Airflow,BoundaryConditions,Controls}"
  - TEST_ARG="make test-dymola    PACKAGE=IDEAS.{Media,Utilities}"
  - TEST_ARG="make test-dymola    PACKAGE=IDEAS.{Buildings}"  

before_install:
  - sudo cp IDEAS/Resources/Scripts/travis/usr/local/bin/dymola /usr/local/bin/
  - sudo chmod +x /usr/local/bin/dymola
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
  - if [[ "$TEST_ARG" == *test-dymola* ]];    then docker pull "$DOCKER_USERNAME"/private:unittests; fi;

# Install dependencies
# For sphinx, we need to install specific package versions, otherwise
# the html output may have small formatting differences which causes
# the test to fail
install:
  - pip install --upgrade pip setuptools wheel
  - pip install --only-binary=numpy,scipy,matplotlib numpy scipy matplotlib
  - pip install git+https://github.com/lbl-srg/BuildingsPy@master

# Execute tests
script:
  - (cd IDEAS/Resources/Scripts/travis && travis_wait 70 $TEST_ARG)
